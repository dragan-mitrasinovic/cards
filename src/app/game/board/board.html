<div class="board-container">
  <div class="board">
    @for (slot of board(); track $index) {
      <div
        class="slot"
        [class.slot-empty]="!slot.occupied"
        [class.slot-placeable]="!slot.occupied && selectedCardIndex() >= 0 && isMyTurn()"
        [class.slot-peekable]="slot.occupied && slot.byPlayer === playerNumber() && !swapMode()"
        [class.slot-swappable]="slot.occupied && swapMode()"
        [class.slot-swap-selected]="isSwapSelected($index)"
        (click)="onSlotClick($index)"
      >
        @if (slot.occupied) {
          <app-card
            class="pointer-events-none"
            [card]="slot.card"
            [faceUp]="!!slot.card"
            [ownCard]="slot.byPlayer === playerNumber()"
            [revealed]="revealMode() && !!slot.card"
          />
        } @else {
          <span class="slot-number">{{ $index + 1 }}</span>
        }
      </div>
    }
  </div>
  @if (swapHistory().length > 0) {
    <svg class="swap-arrows" viewBox="0 0 1344 50" preserveAspectRatio="none">
      @for (swap of swapHistory(); track $index) {
        <path
          [attr.d]="getSwapArrowPath(swap.slotA, swap.slotB)"
          [attr.stroke]="swap.byPlayer === playerNumber() ? '#7c3aed' : '#0ea5e9'"
          fill="none"
          stroke-width="3"
          stroke-linecap="round"
        />
        <circle [attr.cx]="getSwapDotX(swap.slotA)" cy="8" r="5"
          [attr.fill]="swap.byPlayer === playerNumber() ? '#7c3aed' : '#0ea5e9'" />
        <circle [attr.cx]="getSwapDotX(swap.slotB)" cy="8" r="5"
          [attr.fill]="swap.byPlayer === playerNumber() ? '#7c3aed' : '#0ea5e9'" />
      }
    </svg>
  }
</div>
